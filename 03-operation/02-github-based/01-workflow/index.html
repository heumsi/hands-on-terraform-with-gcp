
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Let's learn terraform with GCP step by step" name="description"/>
<meta content="heumsi" name="author"/>
<link href="https://heumsi.github.io/hands-on-terraform-with-gcp/03-operation/02-github-based/01-workflow/" rel="canonical"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.3.1, mkdocs-material-8.5.1" name="generator"/>
<title>작업 흐름 - Hands on Terraform with GCP</title>
<link href="../../../assets/stylesheets/main.2e8b5541.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-6FPTB6BYPR"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-6FPTB6BYPR",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-6FPTB6BYPR",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<meta content="website" property="og:type"/>
<meta content="작업 흐름 - Hands on Terraform with GCP" property="og:title"/>
<meta content="Let's learn terraform with GCP step by step" property="og:description"/>
<meta content="https://heumsi.github.io/hands-on-terraform-with-gcp/assets/images/social/03-operation/02-github-based/01-workflow.png" property="og:image"/>
<meta content="image/png" property="og:image:type"/>
<meta content="1200" property="og:image:width"/>
<meta content="630" property="og:image:height"/>
<meta content="https://heumsi.github.io/hands-on-terraform-with-gcp/03-operation/02-github-based/01-workflow/" property="og:url"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="작업 흐름 - Hands on Terraform with GCP" name="twitter:title"/>
<meta content="Let's learn terraform with GCP step by step" name="twitter:description"/>
<meta content="https://heumsi.github.io/hands-on-terraform-with-gcp/assets/images/social/03-operation/02-github-based/01-workflow.png" name="twitter:image"/>
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>html.glightbox-open { overflow: initial; height: 100%; }</style><script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="white" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_1">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Hands on Terraform with GCP" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Hands on Terraform with GCP">
<img alt="logo" src="../../../assets/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Hands on Terraform with GCP
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              작업 흐름
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="white" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/heumsi/hands-on-terraform-with-gcp" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Hands on Terraform with GCP" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Hands on Terraform with GCP">
<img alt="logo" src="../../../assets/logo.png"/>
</a>
    Hands on Terraform with GCP
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/heumsi/hands-on-terraform-with-gcp" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        들어가며
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          시작하기
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="시작하기" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          시작하기
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01-getting-started/00-overview/">
        개요
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01-getting-started/01-init-project/">
        프로젝트 초기화하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01-getting-started/02-create-vpc-network/">
        VPC Network 생성하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01-getting-started/03-create-subnet-network/">
        Subnet Network 생성하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01-getting-started/04-create-gce/">
        GCE 인스턴스 생성하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01-getting-started/05-create-external-static-ip/">
        External Static IP 생성하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01-getting-started/06-create-firewalls/">
        Firewall 생성하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../01-getting-started/07-add-ssh-key/">
        SSH로 접속하기
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          리팩토링 하기
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="리팩토링 하기" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          리팩토링 하기
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../02-refactoring/00-overview/">
        개요
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../02-refactoring/01-structure-project/">
        프로젝트 구조화히기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../02-refactoring/02-set-remote-backend/">
        Remote Backend 설정하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../02-refactoring/03-add-type-and-desc-to-variables/">
        Variables에 타입, 설명 추가하기
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
          운영 및 자동화하기
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="운영 및 자동화하기" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          운영 및 자동화하기
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../00-overview/">
        개요
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
          Git 기반
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Git 기반" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Git 기반
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-git-based/00-overview/">
        개요
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-git-based/01-add-gitignore/">
        .gitignore 추가하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-git-based/02-validate-codes/">
        코드 Valdiation 하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-git-based/03-format-codes/">
        코드 Formatting 하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-git-based/04-lint-codes/">
        코드 Linting 하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-git-based/05-add-readme/">
        README.md 추가하기
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3">
          Github 기반
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Github 기반" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Github 기반
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../00-overview/">
        개요
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          작업 흐름
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        작업 흐름
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    간단하게 접근하기
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cd">
    CD 워크플로우를 활용하기
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ci">
    CI 워크플로우를 활용하기
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    정리
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02-refactoring/">
        사전 리팩토링
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_4" id="__nav_4_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3_4">
          PR 시 Actions
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="PR 시 Actions" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_3_4">
<span class="md-nav__icon md-icon"></span>
          PR 시 Actions
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../03-actions-if-pr/00-overview/">
        개요
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03-actions-if-pr/01-pre-commit-actions/">
        Pre-commit 액션
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03-actions-if-pr/02-estimate-costs/">
        추가 예상 비용 확인하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03-actions-if-pr/03-visualize-modified-resources/">
        변경되는 리소스 시각화하기
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_5" id="__nav_4_3_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3_5">
          Push 시 Actions
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Push 시 Actions" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_3_5">
<span class="md-nav__icon md-icon"></span>
          Push 시 Actions
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../04-actions-if-push/00-overview/">
        개요
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04-actions-if-push/01-terraform-apply/">
        Terraform 리소스 적용하기
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04-actions-if-push/02-visualize-current-resources/">
        현재 리소스 시각화하기
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../outro/">
        나가며
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    간단하게 접근하기
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cd">
    CD 워크플로우를 활용하기
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ci">
    CI 워크플로우를 활용하기
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    정리
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/heumsi/hands-on-terraform-with-gcp/edit/master/docs/03-operation/02-github-based/01-workflow.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg>
</a>
<h1 id="_1">작업 흐름</h1>
<p>Github로 Terraform 프로젝트를 운영할 때, 어떤 흐름으로 작업을 진행할 수 있는지 알아봅시다.</p>
<h2 id="_2">간단하게 접근하기</h2>
<p>Github를 활용하는 가장 쉬운 방법은 현재 프로젝트의 내용을 그대로 Github Repository에 올리는 것(push)입니다.
<code>terraform apply</code> 명령어 이후 <code>git push</code> 명령어를 입력하는 규칙을 가지게 되겠죠.
Repository는 코드의 가장 최신 버전을 담는 저장소 용도로 사용될 것입니다.</p>
<pre class="mermaid"><code>graph LR
    A[terraform apply] --&gt; B[git commit] --&gt; C[git push]</code></pre>
<p>이 방법은 매우 간단하기는 하지만 다음과 같은 문제들이 있습니다.</p>
<ol>
<li>
<p><code>terraform apply</code> 이후 작업자가 깜빡하여 <code>git push</code> 를 하지 않는 경우, Repository는 가장 최신 버전을 담는 저장소가 아니게 됩니다. 이렇게 실수할 일이 얼마나 있겠냐만은, 사람이 수동으로 하나씩 해줘야 하는 일이기 때문에 분명히 일어날 가능성이 있습니다.</p>
</li>
<li>
<p>만약 Terraform 프로젝트를 다루는 작업자가 두 명 이상일 경우, 위 경우의 여파로 최신 버전이 아닌 Repository를 받아와(clone 또는 pull) <code>terraform apply</code> 명령어를 입력하게 될 것입니다. 이 때 프로비저닝된 리소스는 꼬이게 될 것입니다.</p>
</li>
</ol>
<p>만약 Terraform 프로젝트르 다루는 작업자가 본인 혼자 뿐이라면, 1번 문제를 잘 인지하고 컨트롤 할 수 있을지 모릅니다. 그러나 혼자가 아니라면 2번 문제가 매우 심각한 이슈가 되고, 이렇게 단순하게 Github를 사용할 수 없게 됩니다.</p>
<h2 id="cd">CD 워크플로우를 활용하기</h2>
<p>좀 더 생각해볼 수 있는 방법은 <code>terraform apply</code> 를 사람이 직접 수행하지 않고, 자동화 워크플로우 도구로 실행하는 것입니다. Github Action을 이용하면 <code>git push</code> 가 파이프라인의 트리거가 되고, 파이프라인에서 <code>terraform apply</code> 를 수행할 것입니다.</p>
<pre class="mermaid"><code>flowchart LR
    subgraph Local
        A[git commit] --&gt; B[git push]
    end
    subgraph Github Action
        C[terraform apply]
    end
    B --&gt; C</code></pre>
<p>이 방법은 <code>git push</code> 와 <code>terraform apply</code> 를 항상 같이 동작하도록 만들기 때문에 위에서의 1번 문제를 어느정도 해결할 수 있게 됩니다. 또한 Repository도 항상 최신 코드와 리소스 상태를 표현하게 됩니다.</p>
<p>그러나 이 방법의 또 다른 문제점은 <code>terraform plan</code> 이나 <code>terraform apply</code> 를 사용자가 직접 실행해볼 수 없기 때문에, 코드의 변경이 어떤 리소스의 변화를 만드는지 명시적으로 알기 어렵습니다. 클라우드 리소스 변경은 모두 비용과 직접적으로 이어지는 것이라 매우 예민한 부분입니다. 이러한 예민한 변경이 명시적으로 드러나지 않는다면, 예기치 못한 문제를 발생시킬 수도 있습니다.</p>
<p>물론 Terraform CLI가 사용하는 ServiceAccount 권한을 적절히 설정하거나 분리하면 사용자가 직접 미리 실행해보아 어떤 변경을 만들어내는지 미리 확인할 수도 있습니다. 하지만 ServiceAcccount에 예외를 두거나 별도의 규칙을 만드는 작업들은 추후에 운영 복잡도를 더 높일 수 있습니다.</p>
<h2 id="ci">CI 워크플로우를 활용하기</h2>
<p>변경사항이 최종적으로 반영되기 전에 프로젝트 작업자들에게 명시적으로 이를 공유하고, 리뷰를 거쳐 최종 변경을 승인하는 작업, 이 기능을 Github에서는 PR(Pull Request)이라는 기능을 통해 가능합니다.</p>
<p>PR을 통해 리소스 변경 사항을 팀원들에게 공유하고, PR 생성 및 그 안의 Commit이 트리거가 되는 파이프라인을 만들어, 그 안에서 코드 검증, 리소스 변경 추적을 사전에 명시적으로 드러나게할 수 있습니다. 특히 명시적인 텍스트나 이미지를 해당 PR의 코멘트로 자동으로 추가되도록 할 수 있습니다.</p>
<pre class="mermaid"><code>flowchart LR
    subgraph Local
        A[git commit] --&gt; B[git push]
    end
    subgraph "Github Actions (on PR)"
        C[terraform plan]
    end
    B --&gt; C
    subgraph "Github Actions (on Push)"
        D[terraform apply]
    end
    C --&gt; D</code></pre>
<p>이전보다 조금 더 복잡해지긴 했지만, 위에서 생각한 문제점들을 자연스레 해결할 수 있게되었습니다.</p>
<h2 id="_3">정리</h2>
<p>이제 전체적인 작업흐름을 구체적으로 정리해봅시다.</p>
<ol>
<li>작업자는 본인의 로컬에서 새로운 브랜치를 만든 뒤 작업합니다.</li>
<li>작업자는 작업을 마치고 Github Repsotiory에 Push하고 <code>main</code> 브랜치로 PR을 생성합니다.</li>
<li>이 때 Github Action으로 코드를 검증하고 리소스 변경을 확인하는 파이프라인이 실행되고 이 결과를 PR 코멘트로 남깁니다.</li>
<li>리뷰어가 있다면, 변경 사항을 확인하고 Approve 합니다.</li>
<li>작업자는 <code>main</code> 브랜치로 해당 PR을 Merge 합니다.</li>
<li>이 때 Github Action으로 <code>terraform apply</code> 를 입력하는 파이프라인이 실행됩니다.</li>
</ol>
<pre class="mermaid"><code>flowchart LR
    subgraph Local
        E[git switch -c 'BRANCH_NAME'] --&gt; F[git add .]--&gt; A[git commit] --&gt; B[git push]
    end
    subgraph "Github Actions (on PR)"
        C[terraform plan]
    end
    B --&gt; C
    subgraph "Github PR"
        G[reviewed by peer] --&gt; H[approved by peer] --&gt; I[merged]
    end
    C --&gt; G
    subgraph "Github Actions (on Push)"
        D[terraform apply]
    end
    I --&gt; D</code></pre>
<p>앞으로 사용자가 Terraform CLI를 본인의 로컬 환경에서 직접 실행할 일은 없습니다.
로컬에서는 pre-commit으로 코드 검증을 마치고, PR에 Push 됨으로써 오직 Github Action 파이프라인만 Terraform CLI를 실행하게 됩니다.</p>
<p>이제 구체적으로 PR과 Push (<code>main</code> 브랜치) 트리거 시 실행되는 Github Action 파이프라인을 직접 구현해봅시다.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: 개요" class="md-footer__link md-footer__link--prev" href="../00-overview/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              개요
            </div>
</div>
</a>
<a aria-label="Next: 사전 리팩토링" class="md-footer__link md-footer__link--next" href="../02-refactoring/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              사전 리팩토링
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © heumsi
    </div>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/heumsi" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/in/siheum-jeon-04222a1b3/" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
<a class="md-social__link" href="https://www.facebook.com/heumsi/" rel="noopener" target="_blank" title="www.facebook.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.d691e9de.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "width": "100%", "height": "auto", "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body>
</html>